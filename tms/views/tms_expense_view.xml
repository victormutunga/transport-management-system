<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_tms_expense_tree" model="ir.ui.view">
            <field name="name">tms.expense.tree</field>
            <field name="model">tms.expense</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <tree colors="gray:state=='cancel';green:state=='approved';blue:state=='confirmed';" string="Waybills">
                    <button groups="tms.group_expense_approve" icon="fa-thumbs-up" name="action_approved" states="draft" string="Approve" type="object"/>
                    <button groups="tms.group_expense_confirm" icon="fa-check-square-o" name="action_confirm" states="approved" string="Confirm" type="object"/>
                    <field name="name"/>
                    <field name="date"/>
                    <field name="employee_id"/>
                    <field name="vehicle_id"/>
                    <field name="amount_advance" sum="Advances"/>
                    <field name="amount_net_salary" sum="Net Salary"/>
                    <field name="amount_subtotal_real" sum="SubTotal (Real)"/>
                    <field name="amount_tax_real" sum="Tax Real"/>
                    <field name="amount_total_real" sum="Total Real"/>
                    <field name="amount_balance" sum="Balance"/>
                    <field invisible="1" name="move_id"/> 
                     <field name="paid"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record id="view_tms_expense_form" model="ir.ui.view">
            <field name="name">tms.expense.form</field>
            <field name="model">tms.expense</field>
            <field name="arch" type="xml">
                <form string="Travel Expenses">
                   <header>
                        <button name="action_draft" icon="fa-reply" type="object"
                                string="Reset to draft"
                                states="approved"/>
                        <button name="action_approved" icon="fa-thumbs-up" type="object"
                                string="Approve" states="draft"
                                class="oe_highlight"/>
                        <button name="action_confirm" type="object"
                                string="Confirm" icon="fa-check-square-o" states="approved"
                                class="oe_highlight"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                        <h1>
                            <label class="oe_inline" style="font-size:30px;" string="Expense - " attrs="{'invisible':[('name','=', False)]}"/>
                            <field class="oe_inline" name="name" readonly="1"/>
                        </h1>
                        <group col="4">
                            <field name="base_id"/>
                            <field name="date"/>
                            <field name="unit_id" domain="[('base_id', '=', base_id)]"/>
                            <field name="employee_id" domain="[('base_id','=',base_id)]"/>
                            <field name="currency_id"/>
                        </group>
                        <notebook>
                            <page string="Resume">
                                <group col="4">
                                    <div>
                                        <group>
                                            <separator colspan="2" string="Resumen de Gastos"/>
                                            <field name="amount_salary"/>
                                            <field name="amount_salary_discount"/>
                                            <field name="amount_salary_retention"/>
                                            <field name="amount_real_expense"/>
                                            <field name="amount_subtotal_real"/>
                                            <field name="amount_tax_real"/>
                                            <field name="amount_total_real"/>
                                            <field name="amount_advance"/>
                                            <field name="amount_balance"/>
                                            <separator colspan="2" string="Including Fuel Vouchers"/>
                                            <field name="amount_fuel"/>
                                            <field name="amount_subtotal_total"/>
                                            <field name="amount_tax_total"/>
                                            <field name="amount_total_total"/>
                                            <separator colspan="2" string="· · · · · · · · · ·" style="text-align: center;"/>
                                            <field name="amount_madeup_expense"/>
                                        </group>
                                    </div>
                                    <div/>
                                </group>
                            </page>
                            <page string="Travels">
                                <separator colspan="4" string="Travels for Driver"/>
                                <field  name="travel_ids" colspan="4" domain="[('employee_id','=', employee_id), ('state','=', 'done'), ('state','!=','cancel'), ('unit_id', '=', unit_id)]" nolabel="1" >
                                    <tree string="" default_order="name">
                                        <field invisible="1" name="state"/>
                                        <field name="name"/>
                                        <field name="date"/>
                                        <field name="dolly_id"/>
                                        <field name="trailer2_id"/>
                                        <field name="route_id"/>
                                        <field avg="Rend" name="fuel_efficiency_travel"/>
                                        <field avg="Rendx" name="fuel_efficiency_extraction"/>
                                        <field name="odometer" sum="Distancia Real"/>
                                    </tree>
                                </field>
                               
                                <newline/>
                                <separator colspan="4" string="Global Performance"/>
                                <group col="4" colspan="4">
                                    <group col="2" colspan="2" string="Distances">
                                        <field name="distance_routes"/>
                                        <field name="distance_real" />
                                        <field name="current_odometer" />
                                        <field attrs="{'invisible':[('odometer_log_id','=',False)]}" name="vehicle_id"/>
                                        <field attrs="{'invisible': True}" name="last_odometer"/>
                                        <field attrs="{'invisible': True}" name="vehicle_odometer"/>
                                        <field attrs="{'invisible':[('odometer_log_id','=',False)]}" name="odometer_log_id"/>
                                    </group>
                                    <group col="2" colspan="2" string="Fuel">
                                        <field name="fuel_qty"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Expense Lines">
                                <field context="{'default_expense_id': active_id, 'group_by_line_type': 1, 'default_travel_ids': travel_ids}" name="expense_line_ids" nolabel="1"/>
                            </page>
                            <page string="Advances">
                                <field colspan="4" name="advance_ids" nolabel="1" readonly="1">
                                    <tree string="">
                                        <field invisible="1" name="state"/>
                                        <field name="name"/>
                                        <field name="date"/>
                                        <field name="travel_id"/>
                                        <field name="employee_id"/>
                                        <field name="amount"/>
                                        <field name="auto_expense"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Fuel log Vouchers">
                                <field colspan="4" name="fuel_log_ids" nolabel="1" readonly="1"/>
                            </page>
                            <page string="Notes">
                                <group>
                                    <field colspan="4" name="notes" nolabel="1"/>
                                </group>
                                <group>
                                    <field name='move_id' readonly='1'/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" placeholder="Share a message..." widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="view_tms_expense_filter" model="ir.ui.view">
            <field name="name">tms.expense.list.select</field>
            <field name="model">tms.expense</field>
            <field name="arch" type="xml">
                <search string="Search Expenses">
                    <filter domain="[('state','=','draft')]" string="Draft"/>
                    <filter domain="[('state','=','approved')]" string="Approved"/>
                    <filter domain="[('state','=','confirmed')]" string="Confirmed"/>
                    <filter domain="[('paid','=',0)]" string="Not Paid"/>
                    <filter domain="[('paid','=',1)]" string="Paid"/>
                    <field name="employee_id"/>
                    <field name="date" string="Expense date"/>
                    <field name="name" select="1"/>
                    <filter context="{'group_by':'employee_id'}" string="Driver"/>
                    <filter context="{'group_by':'state'}" string="State"/>
                    <filter context="{'group_by':'date'}" string="Period"/>
                    <filter context="{'group_by':'paid'}" string="Paid"/>
                </search>
            </field>
        </record>
        <record id="view_tms_expense_calendar" model="ir.ui.view">
            <field name="name">tms.expense.calendar</field>
            <field name="model">tms.expense</field>
            <field name="arch" type="xml">
                <calendar color="state" date_start="date" string="Expense">
                    <field name="employee_id"/>
                    <field name="amount_balance"/>
                </calendar>
            </field>
        </record>
        <record id="view_tms_expense_graph" model="ir.ui.view">
            <field name="name">tms.expense.graph</field>
            <field name="model">tms.expense</field>
            <field name="arch" type="xml">
                <graph string="Expense" type="bar">
                    <field name="employee_id"/>
                    <field name="amount_balance" operator="+"/>
                </graph>
            </field>
        </record>
        <record id="action_tms_expense_form" model="ir.actions.act_window">
            <field name="name">Travel Expenses</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">tms.expense</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field name="search_view_id" ref="view_tms_expense_filter"/>
            <field name="help">TMS Travel Expenses</field>
        </record>
        <menuitem action="action_tms_expense_form" id="menu_tms_expense" parent="menu_tms_travels" sequence="40"/>
    </data>
</odoo>
